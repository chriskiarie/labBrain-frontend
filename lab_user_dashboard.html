<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LabBrain - Lab User Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .dashboard-header {
            background: #fff;
            border-bottom: 1px solid #e2e8f0;
            padding: 0 2rem;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .dashboard-logo {
            height: 60px;
            width: auto;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .main-content {
            padding: 2rem;
            background: #f8fafc;
            min-height: calc(100vh - 80px);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .welcome-section {
            width: 100vw;
            max-width: 100vw;
            margin-left: 50%;
            transform: translateX(-50%);
            border-radius: 1.25rem;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 2.5rem 2.5rem 2.5rem 2.5rem;
            margin-bottom: 0.2rem;
            box-shadow: 0 4px 24px rgba(37,99,235,0.08);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .welcome-section h2, .welcome-section p {
            margin-left: 0;
            margin-right: 0;
        }
        
        .topic-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .topic-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }
        
        .topic-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .topic-card.active {
            border-color: #3b82f6;
            background: #f0f9ff;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);
        }
        
        .topic-icon {
            width: 48px;
            height: 48px;
            background: #f0f9ff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: #3b82f6;
            font-size: 1.5rem;
        }
        
        .topic-card.active .topic-icon {
            background: #3b82f6;
            color: white;
        }
        
        .topic-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .topic-card.active .topic-title {
            color: #1d4ed8;
        }
        
        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s ease;
        }
        
        .logout-btn:hover {
            background: #dc2626;
        }

        /* Main Chat Area */
        .chat-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header h3 {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .current-topic {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: #f8fafc;
        }

        .chat-bubble {
            background: white;
            color: #374151;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 1rem 1.25rem;
            border-radius: 20px;
            font-size: 0.95rem;
            line-height: 1.5;
            max-width: 75%;
        }

        .chat-row {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .chat-row.user {
            flex-direction: row-reverse;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .chat-row.user .chat-avatar {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
        }

        .chat-row.bot .chat-avatar {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .typing-indicator {
            display: none;
            padding: 1rem 1.25rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            color: #2563eb;
            font-size: 0.95rem;
            max-width: 75%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 1rem;
        }

        .typing-dots {
            display: inline-block;
            min-width: 2em;
            letter-spacing: 2px;
        }

        .typing-dots span {
            display: inline-block;
            width: 6px;
            height: 6px;
            margin: 0 2px;
            background: #2563eb;
            border-radius: 50%;
            opacity: 0.5;
            animation: typing-bounce 1.2s infinite both;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing-bounce {
            0%, 80%, 100% { transform: scale(0.7); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        .ai-mode-toggle {
            background: #f1f5f9;
            color: #2563eb;
            border: none;
            border-radius: 999px;
            padding: 0.5rem 1.2rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
        }
        .ai-mode-toggle.active, .ai-mode-toggle:focus {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: #fff;
            outline: none;
        }

        .onboarding-row {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 0.2rem;
            position: relative;
            min-height: 90px;
        }
        .onboarding-card {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .onboarding-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 78px;
            height: 78px;
            font-size: 2.3rem;
            color: #059669;
            margin: 0;
        }
        .onboarding-card:not(:hover) .onboarding-label,
        .onboarding-card:not(:hover) .onboarding-arrow,
        .onboarding-card:not(:hover) .onboarding-getstarted {
            opacity: 0;
            max-width: 0;
            pointer-events: none;
        }
        .onboarding-label, .onboarding-arrow, .onboarding-getstarted {
            opacity: 1;
            max-width: 300px;
            transition: opacity 0.18s linear, max-width 0.32s linear;
        }
        .onboarding-label {
            font-weight: bold;
            color: #065f46;
            font-size: 1.08rem;
            margin-left: 0.7rem;
            margin-right: 0.7rem;
            white-space: nowrap;
        }
        .onboarding-getstarted {
            color: #047857;
            font-size: 0.97rem;
            font-weight: 600;
            margin-right: 0.7rem;
            margin-left: 0.2rem;
            white-space: nowrap;
        }
        .onboarding-arrow {
            font-size: 1.3rem;
            color: #059669;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .blue-gradient { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
        .ai-avatar-blue {
            width: 48px;
            height: 48px;
            min-width: 48px;
            min-height: 48px;
            background: #2563eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
            margin-right: 16px;
        }
        .typing-indicator { display: none; }
        .typing-dots-blue {
            display: inline-block;
            min-width: 2em;
            letter-spacing: 2px;
        }
        .typing-dots-blue span {
            display: inline-block;
            width: 6px;
            height: 6px;
            margin: 0 2px;
            background: #2563eb;
            border-radius: 50%;
            opacity: 0.5;
            animation: typing-bounce 1.2s infinite both;
        }
        .typing-dots-blue span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots-blue span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-bounce {
            0%, 80%, 100% { transform: scale(0.7); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        .user-full-width {
            width: 100%;
            max-width: 88vw;
            margin: 0 auto 2.5rem auto;
            border-radius: 2rem;
            box-shadow: 0 4px 32px rgba(37,99,235,0.08);
            background: white;
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }
        @media (max-width: 900px) {
            .user-full-width { max-width: 98vw; }
        }
    </style>
</head>
<body>
    <!-- Dashboard Header -->
    <header class="dashboard-header">
        <div class="flex items-center gap-4">
            <img src="assets/KEBS_LOGO.jpg" alt="KEBS Logo" class="dashboard-logo">
            <div>
                <h1 class="text-xl font-bold text-gray-800">LabBrain</h1>
                <p class="text-sm text-gray-600">AI-Powered Lab Assistant</p>
            </div>
        </div>
        
        <div class="user-info">
            <div class="text-right">
                <p class="font-semibold text-gray-800">Welcome, Chris</p>
                <p class="text-sm text-gray-600">Lab User</p>
            </div>
            <div class="user-avatar">C</div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h2 class="text-2xl font-bold mb-2">Ask LabBrain AI Assistant</h2>
            <p class="text-blue-100">Select a topic below or ask me anything about lab procedures, equipment, standards, and more!</p>
        </div>

        <!-- Topic Filters -->
        <!-- Removed topic cards for cleaner UI -->

        <!-- Onboarding Button Row (restored) -->
        <div class="onboarding-row">
            <div class="onboarding-card" onclick="goToOnboarding()">
                <div class="onboarding-card-content">
                    <div class="onboarding-icon">üéì</div>
                    <div class="onboarding-label">LabBrain Onboarding</div>
                    <div class="onboarding-getstarted">Get Started</div>
                    <div class="onboarding-arrow">‚Üí</div>
                </div>
            </div>
        </div>

        <!-- Main Chat Area (Lab User Chat, Supervisor Logic, Blue Theme) -->
        <div class="chat-container user-full-width">
            <div class="blue-gradient text-white p-6 flex items-center justify-between rounded-t-2xl">
                <h3 class="font-semibold text-lg">LabBrain AI Assistant</h3>
            </div>
            <div id="chatMessages" class="flex-1 p-6 overflow-y-auto bg-gray-50">
                <div class="flex items-start gap-3 mb-6">
                    <div class="ai-avatar-blue">AI</div>
                    <div class="bg-white p-4 rounded-2xl border border-gray-200 max-w-3/4">
                        Hello! I'm LabBrain AI Assistant. I can answer questions based on the documents you've uploaded and analyzed.<br><br>
                        <strong>How to use me:</strong><br>
                        ‚Ä¢ Ask specific questions about your uploaded documents<br>
                        ‚Ä¢ I'll provide brief, direct answers based on the content<br><br>
                        Try asking me about any topic related to your uploaded documents!
                    </div>
                </div>
            </div>
            <div id="typingIndicator" class="typing-indicator p-4 bg-white border border-gray-200 rounded-2xl mx-6 mb-4">
                <span class="typing-dots-blue"><span></span><span></span><span></span></span> <span class="text-gray-600">AI is typing</span>
            </div>
            <div class="p-6 border-t border-gray-200 bg-white rounded-b-2xl">
                <div class="flex gap-3 items-center">
                    <input type="text" id="chatInput" class="flex-1 p-4 border-2 border-gray-200 rounded-full focus:border-blue-500 outline-none" placeholder="Ask the AI about your lab documents..." onkeypress="handleChatKeyPress(event)">
                    <button class="w-12 h-12 blue-gradient text-white rounded-full flex items-center justify-center hover:scale-105 transition-transform" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Load user data from localStorage
        let currentUser = null;
        
        function loadUserData() {
            const userData = localStorage.getItem('user');
            if (userData) {
                currentUser = JSON.parse(userData);
                updateUserDisplay();
            } else {
                // Redirect to login if no user data
                window.location.href = 'Main.html';
            }
        }
        
        function updateUserDisplay() {
            if (currentUser) {
                // Update welcome message
                const welcomeElement = document.querySelector('.text-right p:first-child');
                if (welcomeElement) {
                    welcomeElement.textContent = `Welcome, ${currentUser.fullName || currentUser.username}`;
                }
                
                // Update role display
                const roleElement = document.querySelector('.text-right p:last-child');
                if (roleElement) {
                    roleElement.textContent = currentUser.role === 'supervisor' ? 'Lab Supervisor' : 'Lab User';
                }
                
                // Update avatar initial
                const avatarElement = document.querySelector('.user-avatar');
                if (avatarElement) {
                    avatarElement.textContent = (currentUser.fullName || currentUser.username).charAt(0).toUpperCase();
                }
            }
        }
        
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
        
        // Load user data when page loads
        document.addEventListener('DOMContentLoaded', loadUserData);
        
        let currentAIMode = 'general';
        const aiModeLabels = {
            general: 'General',
            procedures: 'Lab Procedures',
            standards: 'Standards',
            troubleshooting: 'Troubleshooting',
            reports: 'Reports'
        };
        const aiModePlaceholders = {
            general: 'Ask me anything about lab procedures, equipment, standards...',
            procedures: 'Ask about lab procedures...',
            standards: 'Ask about standards and guidelines...',
            troubleshooting: 'Describe your troubleshooting issue...',
            reports: 'Ask about reports or data...'
        };

        function switchAIMode(mode) {
            currentAIMode = mode;
            // Update toggle button styles
            document.querySelectorAll('.ai-mode-toggle').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-mode') === mode);
            });
            // Update chat header and topic label
            document.getElementById('currentTopic').textContent = aiModeLabels[mode];
            // Update input placeholder
            document.getElementById('chatInput').placeholder = aiModePlaceholders[mode];
            // Optionally update welcome message
            document.getElementById('chatWelcomeContent').innerHTML =
                `Hello! I'm your LabBrain AI assistant. I can help you with ${aiModeLabels[mode].toLowerCase()}. <br><br><strong>You're now in <span style='color:#2563eb;'>${aiModeLabels[mode]}</span> mode.</strong>`;
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Get token from localStorage
                const token = localStorage.getItem('token');
                if (!token) {
                    hideTypingIndicator();
                    addMessage('Please log in to use the AI chat.', 'bot');
                    return;
                }
                
                // Call the AI backend, include current mode for context
                const response = await fetch('https://labbrain-backend.onrender.com/api/ai/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                
                hideTypingIndicator();
                
                if (data.success) {
                    addMessage(data.data.response, 'bot');
                } else {
                    addMessage('Sorry, I encountered an error. Please try again.', 'bot');
                }
            } catch (error) {
                hideTypingIndicator();
                addMessage('Sorry, I encountered an error. Please try again.', 'bot');
                console.error('Chat error:', error);
            }
        }

        function addMessage(content, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start gap-3 mb-6' + (sender === 'user' ? ' flex-row-reverse' : '');
            const avatar = document.createElement('div');
            if (sender === 'user') {
                avatar.className = 'w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold text-sm';
                avatar.style.background = 'linear-gradient(135deg, #2563eb, #1d4ed8)';
                avatar.textContent = 'C';
            } else {
                avatar.className = 'ai-avatar-blue';
                avatar.textContent = 'AI';
            }
            const messageContent = document.createElement('div');
            messageContent.className = 'p-4 rounded-2xl max-w-3/4';
            messageContent.style.background = sender === 'user' ? 'linear-gradient(135deg, #2563eb, #1d4ed8)' : 'white';
            messageContent.style.color = sender === 'user' ? 'white' : '#374151';
            messageContent.style.border = sender === 'user' ? 'none' : '1px solid #e5e7eb';
            messageContent.innerHTML = content;
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function generateAIResponse(userMessage, topic) {
            const message = userMessage.toLowerCase();
            
            // Topic-specific responses
            if (topic === 'procedures') {
                if (message.includes('calibration') || message.includes('calibrate')) {
                    return "üìã **Calibration Procedure (ISO 17025 Compliant):**\n\n1. **Pre-calibration Setup:**\n   - Verify equipment is clean and stable\n   - Check environmental conditions (temperature, humidity)\n   - Prepare calibration standards\n\n2. **Calibration Process:**\n   - Perform zero adjustment\n   - Measure at multiple points across range\n   - Record all measurements with uncertainties\n\n3. **Documentation:**\n   - Complete calibration certificate\n   - Record measurement uncertainties\n   - Note any deviations or adjustments\n\nWould you like the specific procedure for a particular piece of equipment?";
                }
                else if (message.includes('sop') || message.includes('standard operating')) {
                    return "üìã **Standard Operating Procedures Available:**\n\n‚Ä¢ **Equipment Operation SOPs:**\n  - Spectrophotometer operation\n  - pH meter calibration\n  - Balance verification\n  - Temperature monitoring\n\n‚Ä¢ **Safety SOPs:**\n  - Chemical handling\n  - Personal protective equipment\n  - Emergency procedures\n  - Waste disposal\n\n‚Ä¢ **Quality Control SOPs:**\n  - Sample preparation\n  - Data recording\n  - Quality checks\n  - Deviation handling\n\nWhich specific SOP do you need?";
                }
                else {
                    return "üìã I'm in **Lab Procedures** mode. I can help you with:\n\n‚Ä¢ Equipment calibration procedures\n‚Ä¢ Standard Operating Procedures (SOPs)\n‚Ä¢ Safety protocols\n‚Ä¢ Quality control procedures\n‚Ä¢ Sample preparation methods\n‚Ä¢ Data recording procedures\n\nWhat specific procedure do you need help with?";
                }
            }
            else if (topic === 'standards') {
                if (message.includes('iso') || message.includes('17025')) {
                    return "üìè **ISO 17025:2017 Standards Overview:**\n\n**Management Requirements:**\n‚Ä¢ Document control\n‚Ä¢ Management system\n‚Ä¢ Service to client\n‚Ä¢ Complaints and appeals\n‚Ä¢ Control of records\n‚Ä¢ Internal audits\n‚Ä¢ Management reviews\n\n**Technical Requirements:**\n‚Ä¢ Personnel competence\n‚Ä¢ Accommodation and environmental conditions\n‚Ä¢ Equipment and reference materials\n‚Ä¢ Metrological traceability\n‚Ä¢ Sampling and handling\n‚Ä¢ Assuring quality of results\n‚Ä¢ Reporting results\n\nWhich specific aspect of ISO 17025 do you need details on?";
                }
                else if (message.includes('quality') || message.includes('assurance')) {
                    return "üìè **Quality Assurance Standards:**\n\n‚Ä¢ **Internal Quality Control:**\n  - Regular monitoring of measurement processes\n  - Use of control charts\n  - Participation in proficiency testing\n\n‚Ä¢ **External Quality Assessment:**\n  - Inter-laboratory comparisons\n  - Proficiency testing programs\n  - Accreditation requirements\n\n‚Ä¢ **Documentation Standards:**\n  - Method validation requirements\n  - Uncertainty calculations\n  - Result reporting formats\n\nWhat specific quality standard are you looking for?";
                }
                else {
                    return "üìè I'm in **Standards & Guidelines** mode. I can help you with:\n\n‚Ä¢ ISO 17025:2017 requirements\n‚Ä¢ Quality assurance standards\n‚Ä¢ Metrological traceability\n‚Ä¢ Uncertainty calculations\n‚Ä¢ Accreditation requirements\n‚Ä¢ Regulatory compliance\n‚Ä¢ Best practices and guidelines\n\nWhat standard or guideline do you need information about?";
                }
            }
            else if (topic === 'troubleshooting') {
                if (message.includes('error') || message.includes('problem') || message.includes('issue')) {
                    return "üîß **Equipment Troubleshooting Guide:**\n\n**Common Issues & Solutions:**\n\n1. **Equipment Not Powering On:**\n   - Check power supply and connections\n   - Verify circuit breakers\n   - Test with different outlet\n\n2. **Inaccurate Readings:**\n   - Check calibration status\n   - Verify environmental conditions\n   - Clean sensors/probes\n   - Check for interference\n\n3. **Error Messages:**\n   - Note exact error code/message\n   - Check user manual\n   - Verify input parameters\n   - Contact technical support if needed\n\nPlease describe the specific problem you're experiencing for more targeted help.";
                }
                else if (message.includes('maintenance') || message.includes('preventive')) {
                    return "üîß **Preventive Maintenance Schedule:**\n\n**Daily Checks:**\n‚Ä¢ Visual inspection for damage\n‚Ä¢ Basic functionality tests\n‚Ä¢ Environmental monitoring\n\n**Weekly Checks:**\n‚Ä¢ Calibration verification\n‚Ä¢ Performance checks\n‚Ä¢ Cleaning procedures\n\n**Monthly Checks:**\n‚Ä¢ Detailed calibration\n‚Ä¢ Performance validation\n‚Ä¢ Documentation review\n\n**Quarterly Checks:**\n‚Ä¢ Comprehensive maintenance\n‚Ä¢ Software updates\n‚Ä¢ Staff training verification\n\nWhat equipment maintenance do you need help with?";
                }
                else {
                    return "üîß I'm in **Equipment Troubleshooting** mode. I can help you with:\n\n‚Ä¢ Equipment error diagnosis\n‚Ä¢ Performance issues\n‚Ä¢ Calibration problems\n‚Ä¢ Preventive maintenance\n‚Ä¢ Repair procedures\n‚Ä¢ Technical specifications\n‚Ä¢ User manual guidance\n\nWhat equipment problem are you experiencing?";
                }
            }
            else if (topic === 'reports') {
                if (message.includes('generate') || message.includes('create') || message.includes('report')) {
                    return "üìä **Report Generation Guide:**\n\n**Available Report Types:**\n\n1. **Calibration Reports:**\n   - Equipment identification\n   - Calibration results\n   - Measurement uncertainties\n   - Traceability information\n\n2. **Test Reports:**\n   - Sample information\n   - Test methods used\n   - Results with uncertainties\n   - Compliance statements\n\n3. **Quality Control Reports:**\n   - Control chart data\n   - Trend analysis\n   - Outlier identification\n   - Corrective actions\n\n4. **Trend Analysis Reports:**\n   - Historical data analysis\n   - Performance trends\n   - Statistical analysis\n   - Recommendations\n\nWhat type of report do you need to generate?";
                }
                else if (message.includes('data') || message.includes('analysis')) {
                    return "üìä **Data Analysis Tools Available:**\n\n‚Ä¢ **Statistical Analysis:**\n  - Mean, standard deviation\n  - Confidence intervals\n  - Trend analysis\n  - Outlier detection\n\n‚Ä¢ **Graphical Representations:**\n  - Control charts\n  - Histograms\n  - Scatter plots\n  - Time series analysis\n\n‚Ä¢ **Quality Metrics:**\n  - Process capability\n  - Measurement system analysis\n  - Uncertainty budgets\n  - Proficiency test results\n\nWhat type of data analysis do you need?";
                }
                else {
                    return "üìä I'm in **Reports & Data** mode. I can help you with:\n\n‚Ä¢ Report generation and templates\n‚Ä¢ Data analysis and statistics\n‚Ä¢ Quality control reporting\n‚Ä¢ Trend analysis\n‚Ä¢ Performance metrics\n‚Ä¢ Compliance reporting\n‚Ä¢ Data visualization\n\nWhat reporting or data analysis do you need help with?";
                }
            }
            else {
                // General mode responses
                if (message.includes('calibration') || message.includes('calibrate')) {
                    return "For equipment calibration, please follow ISO 17025 standards. The calibration procedure involves: 1) Pre-calibration checks, 2) Standard measurements, 3) Uncertainty calculations, and 4) Documentation. Would you like me to show you the specific procedure for your equipment?";
                }
                else if (message.includes('procedure') || message.includes('sop')) {
                    return "I can help you find the right Standard Operating Procedure (SOP). What type of procedure are you looking for? Common categories include: Equipment Operation, Safety Protocols, Quality Control, and Data Analysis.";
                }
                else if (message.includes('troubleshoot') || message.includes('problem') || message.includes('issue')) {
                    return "I can help you troubleshoot equipment issues. Please describe the problem you're experiencing, including any error messages or unusual behavior. I'll guide you through the diagnostic process.";
                }
                else if (message.includes('standard') || message.includes('iso') || message.includes('guideline')) {
                    return "Our lab follows ISO 17025:2017 standards for testing and calibration laboratories. Key areas include: Management Requirements, Technical Requirements, and Quality Assurance. Which specific standard are you interested in?";
                }
                else if (message.includes('report') || message.includes('data')) {
                    return "I can help you generate reports and analyze data. We have templates for: Calibration Reports, Test Reports, Quality Control Reports, and Trend Analysis. What type of report do you need?";
                }
                else if (message.includes('hello') || message.includes('hi')) {
                    return "Hello! I'm here to help you with all your lab-related questions. Feel free to ask about procedures, equipment, standards, or any other lab topics!";
                }
                else if (message.includes('help')) {
                    return "I can help you with: üìã Lab Procedures, üìè Standards & Guidelines, üîß Equipment Troubleshooting, üìä Reports & Data Analysis, and general lab questions. What would you like to know?";
                }
                else {
                    return "I understand you're asking about '" + userMessage + "'. While I'm a demo version, I can help with lab procedures, equipment troubleshooting, standards compliance, and general lab questions. Could you rephrase your question or ask about a specific lab topic?";
                }
            }
        }

        // Check if user is logged in
        window.onload = function() {
            // In a real application, you would check for authentication tokens
            // For now, we'll just ensure they came from the login page
            // Commenting out this check as it's causing issues
            /*
            if (!document.referrer.includes('Main.html')) {
                // Redirect to login if not coming from main page
                window.location.href = 'Main.html';
            }
            */
        }

        function goToOnboarding() {
            window.location.href = 'lab_user_onboarding.html';
        }
    </script>
</body>
</html> 
